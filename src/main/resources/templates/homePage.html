<!DOCTYPE html>
<html xmlns='http://www.w3.org/1999/xhtml' xmlns:th='http://www.thymeleaf.org' lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"></script>
    <link href="https://db.onlinewebfonts.com/c/c94cf70be98883aee29418ee2be4f6eb?family=Cantarell+Regular" rel="stylesheet">
    <link
            rel="stylesheet"
            href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css"
    />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">

    <title>StayInMilan</title>
</head>
<body>

<div id="back" class="background-area">
    <div id="main">
        <header class="d-flex justify-content-center align-items-center">
            <img src="/images/m-1.png" width="300px" height ="300px">
        </header>

        <script>
            // Check if there are errors and set the active tab accordingly
            var hasErrors = /*[[${hasErrors}]]*/ false; // Get the value from Thymeleaf model

            document.addEventListener('DOMContentLoaded', function() {
                var bookTab = document.getElementById('bookTab');
                var homeTab = document.getElementById('homeTab');
                var book = document.getElementById('book');
                var home = document.getElementById("home");

                if (hasErrors) {
                    bookTab.classList.add('active');
                    bookTab.classList.add('clicked');
                    homeTab.classList.remove('active');
                    homeTab.classList.remove('clicked');

                    book.classList.add('show');
                    book.classList.add('active');
                    home.classList.remove('show');
                    home.classList.remove('active');

                } else {
                    homeTab.classList.add('active');
                    homeTab.classList.add('clicked');
                    bookTab.classList.remove('clicked');
                    bookTab.classList.remove('active');
                    book.classList.remove('show');
                    book.classList.remove('active');
                    home.classList.add('show');
                    home.classList.add('active');
                }
            });
        </script>

        <div id="content">
            <ul class="nav nav-tabs" id="myTab">
                <a href="#home" id="homeTab" class="custom-button nav-item active clicked" data-bs-toggle="tab">Home</a>
                <a href="#book" id="bookTab" class="custom-button nav-item" data-bs-toggle="tab">Book</a>
                <a href="#contact" class="custom-button nav-item" data-bs-toggle="tab">Contact</a>
            </ul>
            <div class="tab-content">
                <div class="tab-pane fade show active" id="home">
                    <h1 class="mt-2 titolo">Stay in Milan, Feel at Home</h1>
                    <div class="slideshow-container">
                        <img class="house-images" src="/images/WhatsApp%20Image%202023-06-13%20at%2016.02.29%20(1).jpeg" alt="Image 1">
                        <img class="house-images" src="/images/WhatsApp%20Image%202023-06-13%20at%2016.02.29.jpeg" alt="Image 2">
                        <img class="house-images" src="/images/WhatsApp%20Image%202023-06-13%20at%2016.02.32.jpeg" alt="image 3">
                        <img class="house-images" src="/images/WhatsApp%20Image%202023-06-13%20at%2016.02.34%20(1).jpeg" alt="Image 4">
                        <img class="house-images" src="/images/WhatsApp%20Image%202023-06-13%20at%2016.02.35%20(1).jpeg" alt="Image 7">
                        <img class="house-images" src="/images/WhatsApp%20Image%202023-06-13%20at%2016.02.35.jpeg" alt="Image 8">
                        <img class="house-images" src="/images/WhatsApp%20Image%202023-06-13%20at%2016.02.36%20(1).jpeg" alt="image 9">
                        <img class="house-images" src="/images/WhatsApp%20Image%202023-06-13%20at%2016.02.36%20(2).jpeg" alt="Image 10">
                        <img class="house-images" src="/images/WhatsApp%20Image%202023-06-13%20at%2016.02.36%20(3).jpeg" alt="Image 11">
                        <img class="house-images" src="/images/WhatsApp%20Image%202023-06-13%20at%2016.02.36.jpeg" alt="image 12">
                        <img class="house-images" src="/images/WhatsApp%20Image%202023-06-13%20at%2016.02.37.jpeg" alt="Image 13">
                        <img class="house-images" src="/images/WhatsApp%20Image%202023-06-13%20at%2016.05.01%20(1).jpeg" alt="Image 14">
                        <img class="house-images" src="/images/WhatsApp%20Image%202023-06-13%20at%2016.05.01%20(2).jpeg" alt="image 15">
                        <img class="house-images" src="/images/WhatsApp%20Image%202023-06-13%20at%2016.05.01.jpeg" alt="Image 16">
                        <img class="house-images" src="/images/WhatsApp%20Image%202023-06-13%20at%2016.05.02.jpeg" alt="image 18">
                        <img class="house-images" src="/images/961fb31a-5b4c-4950-9737-fb2726a61260.jpg" alt="image 18">
                    </div>
                    <p class="mt-4 casa-desc">Discover the charm of Milan from our cozy home in Zona Farini.
                        Perfectly suited for up to 4 guests, our inviting retreat offers comfort and
                        convenience for your stay in the city. Experience the best of Milan while enjoying
                        the comforts of a home away from home.
                    </p>

                    <div id="desc-container" class="d-flex">
                        <div class="col-md-4 p-2">
                            <h1>Transport</h1>
                            <p class="desc">
                                Discover Milan's prime location with our cozy home in Zona Farini.
                                Enjoy easy access to transportation, just a 5-minute stroll to Macciachini
                                underground station (M3 Line) and a doorstep 90/91 bus line station. Subway
                                train station Lancetti (S1, S2, S5, S6, S12, S13 lines) is only 2 minutes away,
                                offering seamless connections to various destinations. Experience the city's best
                                with our well-situated home rental.
                            </p>
                        </div>
                        <div class="col-md-4 p-2">
                            <h1>Description</h1>
                            <p class="desc">
                                With a spacious layout, our home boasts one main bedroom providing a peaceful retreat,
                                complemented by an additional room thoughtfully furnished with two double beds and a single bed.
                                Ideal for families, friends, or even solo travelers, our accomodation ensures ample space for everyone
                                to unwind and rest after a day of exploring the wonders of Milan.
                            </p>
                        </div>
                        <div class="col-md-4 p-2">
                            <h1>Accessories</h1>
                            <p class="desc">
                                Indulge in modern comforts during your Milan stay at our inviting home.
                                Stay effortlessly connected with high-speed Wi-Fi. For added convenience,
                                take advantage of the laundry machine to keep your wardrobe fresh and ready.
                                Beat the summer heat with the air conditioner. Unwind and enjoy entertainment on the
                                impressive 72-inch television. Enjoy and create lovely moments during your stay in Milan.
                            </p>
                        </div>
                    </div>

                </div>
                <div class="tab-pane fade" id="book">
                    <h1 class="mt-2 titolo">Book Now</h1>

                    <div class="w-100 d-flex justify-content-center">
                        <div id="form-div">
                            <form class="p-4" th:action="@{/bookings}" th:object="${booking}" method="post">


                                <div class="d-flex justify-content-center">
                                    <ul th:if="${errors}" class="alert alert-danger">
                                        <li th:each="error : ${errors}" th:text="${error.defaultMessage}"></li>
                                    </ul>
                                </div>

                                <div class="d-flex justify-content-between m-2">

                                    <label for="datePicker">Select dates</label>
                                    <input type="text" id="datePicker" placeholder="Select dates">
                                    <script th:inline="javascript">
                                        // Parse the JSON string into a JavaScript array
                                        var bookedDays = /*[(${bookedDaysJson})]*/ [];


                                        // Define prices for specific dates
                                        var pricing = /*[[${pricing}]]*/ {};


                                    </script>


                                    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
                                    <script>

                                        flatpickr("#datePicker", {
                                            mode: "range",
                                            minDate: "today",
                                            dateFormat: "d/m/Y",
                                            disable: bookedDays,
                                            onDayCreate: function(dObj, dStr, fp, dayElem) {
                                                if (dObj.disabled) {
                                                    dayElem.classList.add("disabled");
                                                }
                                            },
                                            onClose: function (selectedDates) {
                                                var isValid = true;
                                                var isValidTwoNights = true;
                                                var totalPrice = 0;

                                                if (selectedDates.length === 2) {
                                                    var checkInDate = selectedDates[0];
                                                    var checkOutDate = selectedDates[1];

                                                    var timeDifference = Math.abs(checkOutDate - checkInDate);
                                                    var numberOfNights = Math.ceil(timeDifference / (1000 * 3600 * 24));

                                                    if (numberOfNights < 2) {
                                                        isValidTwoNights = false;
                                                    } else {
                                                        for (var currentDate = new Date(checkInDate); currentDate <= checkOutDate; currentDate.setDate(currentDate.getDate() + 1)) {
                                                            var isoDate = currentDate.toLocaleDateString('en-GB', { year: 'numeric', month: '2-digit', day: '2-digit' }); // Format as dd/MM/yyyy

                                                            var price = pricing.customPrices[isoDate] || pricing.defaultPrice;

                                                            totalPrice += price;
                                                        }

                                                        var formattedTotalPrice = totalPrice.toFixed(2);

                                                        document.getElementById("totalPrice").textContent = "Total Price: €" + formattedTotalPrice;
                                                        document.getElementById("totalPriceInput").value = formattedTotalPrice;
                                                    }
                                                }

                                                if (!isValidTwoNights) {
                                                    document.getElementById("validationMessage").textContent = "Minimum 2 nights stay required!";
                                                } else {
                                                    document.getElementById("validationMessage").textContent = "";
                                                }

                                                for (var i = 0; i < selectedDates.length; i++) {
                                                    var selectedDate = selectedDates[i];

                                                    if (selectedDate.disabled) {
                                                        isValid = false;
                                                        break;
                                                    }
                                                }

                                                if (!isValid) {
                                                    alert("One or more selected dates are not available!");
                                                    this.clear();
                                                    return;
                                                }

                                                if (selectedDates.length === 2) {
                                                    var checkInDate = selectedDates[0];
                                                    var checkOutDate = selectedDates[1];

                                                    var isoCheckInDate = checkInDate.toLocaleDateString('en-GB', { year: 'numeric', month: '2-digit', day: '2-digit' }); // Format as dd/MM/yyyy
                                                    var isoCheckOutDate = checkOutDate.toLocaleDateString('en-GB', { year: 'numeric', month: '2-digit', day: '2-digit' }); // Format as dd/MM/yyyy

                                                    document.getElementById("checkInDate").value = isoCheckInDate;
                                                    document.getElementById("checkOutDate").value = isoCheckOutDate;

                                                    console.log("Check-in Date (Formatted): " + isoCheckInDate);
                                                    console.log("Check-out Date (Formatted): " + isoCheckOutDate);
                                                }
                                            }
                                        });

                                    </script>
                                </div>
                                <div class="d-flex justify-content-center">
                                    <p id="validationMessage" class="text-danger"></p>
                                </div>


                                <div class="d-flex justify-content-between m-2">
                                    <label for="name">Name:</label>
                                    <input type="text" id="name" name="name" th:field="*{name}" required>
                                </div>
                                <div class="d-flex justify-content-between m-2">
                                    <label for="surname">Surname:</label>
                                    <input type="text" id="surname" name="surname" th:field="*{surname}" required>
                                </div>
                                <div class="d-flex justify-content-between m-2">
                                    <label for="email">Email:</label>
                                    <input type="email" id="email" name="email" th:field="*{email}" required>
                                </div>
                                <div class="d-flex justify-content-between m-2">
                                    <label for="numOfGuests">Number of guests (max 4):</label>
                                    <input type="number" id="numOfGuests" name="numOfGuests" th:field="*{numOfGuests}" min="1" max="4">
                                </div>

                                <div class="d-flex justify-content-between m-2">
                                    <label for="checkInDate">You will be checking in this day (after 15:00):</label>
                                    <input type="text" id="checkInDate" name="checkInDate" th:field="*{checkInDate}" required readonly>
                                </div>

                                <div class="d-flex justify-content-between m-2">
                                    <label for="checkOutDate">You will be checking out this day (before 13:00):</label>
                                    <input type="text" id="checkOutDate" name="checkOutDate" th:field="*{checkOutDate}" required readonly>
                                </div>

                                <div class="d-flex justify-content-between m-2">
                                    <p id="totalPrice"></p>
                                    <input type="hidden" id="totalPriceInput" name="totalPrice" th:value="*{totalPaid}">
                                </div>

                                <div class="d-flex justify-content-center m-2">
                                    <button class="btn-form p-2" type="submit">Proceed</button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
                <div class="tab-pane fade" id="contact">
                    <h1 class="mt-2 titolo">Contact Us</h1>
                    <div id="contact-div" class="d-flex">
                        <div class="col-md-4">
                            <p class="desc">Book now for an unforgettable Milan experience filled with comfort, convenience, and cherished memories.</p>
                        </div>
                        <div class="col-md-4">
                            <p class="desc">Email: stayinmilan.info@gmail.com</p>
                            <p class="desc">Phone: +39 3398042104</p><br>
                            <p class="desc">Street: Viale Jenner 60</p>
                            <p class="desc">City/ZIP: Milan, 20158</p>
                        </div>
                        <div id="milano-alto" class="col-md-4">
                            <img src="/images/mialnoAlto.jpg" width="250px" height="250px">
                        </div>
                    </div>
                    <h1>Map Location</h1>
                    <a href="https://www.google.com/maps/search/Viale+Jenner+60+Milan" target="_blank">Open on Google Maps</a>

                    <div id="map" style="width: 100%; height: 400px;"></div>

                    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>

                    <script>
                        var map = L.map('map').setView([45.496910, 9.173790], 16); // Milan coordinates

                        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                            attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',
                        }).addTo(map);

                        L.marker([45.496910, 9.173790])
                            .addTo(map)
                            .bindPopup('Viale Jenner 60, Milan')
                            .openPopup();
                    </script>

                </div>
            </div>
        </div>
        <footer class="d-flex justify-content-between">
            <div class="w-50 d-flex justify-content-center flex-column">
                <p style="color: black;">StayInMilan</p>
                <p><a href="mailto:stayinmilan.info@gmail.com" style="color: white;">stayinmilan.info@gmail.com</a></p>
            </div>
            <span class="w-50">
                <a href="mailto:stayinmilan.info@gmail.com"><img src="/images/gmail.png" style="float: right;" width="50px" height="50px"></a>
            </span>
        </footer>
    </div>
</div>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
    $(document).ready(function () {
        // Add click event handler to each nav-item
        $('.nav-item').click(function () {
            // Remove the "clicked" class from all nav-items
            $('.nav-item').removeClass('clicked');
            // Add the "clicked" class to the clicked nav-item
            $(this).addClass('clicked');

            // Get the target tab pane ID from the href attribute of the clicked nav-item
            var targetTabPane = $(this).attr('href');

            // Remove the "active" class from all nav-items
            $('.nav-item').removeClass('active');
            // Add the "active" class to the clicked nav-item
            $(this).addClass('active');

            // Remove the "show" class from all tab panes
            $('.tab-pane').removeClass('show');
            // Add the "show" class to the target tab pane
            $(targetTabPane).addClass('show');
        });
    });

    document.addEventListener("DOMContentLoaded", function () {
        // Existing code for showing the slides and setting the interval

        const slides = document.querySelectorAll(".slideshow-container img");
        let currentSlide = 0;

        function showSlide(index) {
            slides.forEach((slide) => (slide.style.display = "none"));
            slides[index].style.display = "block";
        }

        function prevSlide() {
            currentSlide = (currentSlide - 1 + slides.length) % slides.length;
            showSlide(currentSlide);
        }

        function nextSlide() {
            currentSlide = (currentSlide + 1) % slides.length;
            showSlide(currentSlide);
        }

        // Show the first slide
        showSlide(currentSlide);

        // Set interval to switch to the next slide every 5 seconds
        setInterval(nextSlide, 3000);
    });
    document.addEventListener("DOMContentLoaded", function () {
        function updateLayout() {
            const descContainerDiv = document.getElementById("desc-container");
            const contactDiv = document.getElementById("contact-div");
            const milanoDiv = document.getElementById("milano-alto");
            if (window.innerWidth < 768) {
                descContainerDiv.classList.add("flex-column");
                contactDiv.classList.add("flex-column");
                milanoDiv.classList.add("hidden");
            } else {
                descContainerDiv.classList.remove("flex-column");
                contactDiv.classList.remove("flex-column");
                milanoDiv.classList.remove("hidden");
            }
        }

        // Run the updateLayout function when the page loads and when the window is resized
        updateLayout();
        window.addEventListener("resize", updateLayout);
    });

</script>


<style>
    @import url(https://db.onlinewebfonts.com/c/c94cf70be98883aee29418ee2be4f6eb?family=Cantarell+Regular);
    @font-face {
        font-family: "Cantarell Regular";
        src: url("https://db.onlinewebfonts.com/t/c94cf70be98883aee29418ee2be4f6eb.eot");
        src: url("https://db.onlinewebfonts.com/t/c94cf70be98883aee29418ee2be4f6eb.eot?#iefix")format("embedded-opentype"),
        url("https://db.onlinewebfonts.com/t/c94cf70be98883aee29418ee2be4f6eb.woff2")format("woff2"),
        url("https://db.onlinewebfonts.com/t/c94cf70be98883aee29418ee2be4f6eb.woff")format("woff"),
        url("https://db.onlinewebfonts.com/t/c94cf70be98883aee29418ee2be4f6eb.ttf")format("truetype"),
        url("https://db.onlinewebfonts.com/t/c94cf70be98883aee29418ee2be4f6eb.svg#Cantarell Regular")format("svg");
    }
    @media screen and (min-width: 768px) {

        #main{

            max-width: 960px;
            margin: 10% auto;
        }

        .custom-button{
            padding: 2%;
        }

        .titolo{
            font-size: 80px;
            color: #84cba4;
            margin-bottom: 5%;
        }

        .desc{
            letter-spacing: 2px;
            color: #868687;
        }

        #form-div{
            width: 50%;
        }

    }
    @media screen and (max-width: 768px){

        #main{
            margin: 10% 0%;
        }

        .custom-button{
            padding: 4%;
        }

        .titolo{
            font-size: 60px;
            color: #84cba4;
            margin-bottom: 5%;
        }
        .desc{
            letter-spacing: 2px;
            color: #868687;
        }

        #form-div{
            width: 100%;
        }

    }


    h1{
        color: #ceb592;
    }

    .casa-desc{
        font-size: 22px;
        color: #868687;
        border-bottom: 3px solid #ceb592; /* Add this line to add the border */
        padding-bottom: 5%; /* Add some padding at the bottom to separate the line from the text */
        font-family: "Cantarell Regular";
    }

    .tab-pane{
        padding: 3%;
        background-color: white;
    }

    .custom-button{
        text-decoration: none;
        color: white;
    }

    #content{
        background-color: #ceb592;
        color: black;
        margin: 5% 0%;
        margin-bottom: 0%;
    }

    #back {
        background: url(/images/544b294d883d48eb70ff7ca09eecb66c.jpeg) no-repeat;
        background-position: center center;
        background-size: cover;
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        overflow-y: auto; /* This enables vertical scrolling */
    }

    .background-area{
        height: 100vh;
        width: 100vw;
    }

    .nav-item{
        background-color: #ceb592;
    }

    header{
        background-color: transparent;
    }

    .clicked{
        background-color: #84cba4;
        color: white;
    }

    .nav-item:hover{
        background-color: #84cba4;
        color: white;
        text-decoration: none;
    }

    .slideshow-container {
        max-width: 100%;
        max-height: 100%;
        overflow-x: scroll;
        overflow-y: hidden;
        white-space: nowrap;
        -webkit-overflow-scrolling: touch;

        &::-webkit-scrollbar {
             display: none;
         }
    }

    .slideshow-container img {
        display: none;
        width: 100%;
    }

    .slideshow-container img:first-child {
        display: block;
    }

    footer{
        background-color: #ceb592;
        color: white;
        padding: 5% 10%;
    }

    .hidden{
        display: none;
    }

    .btn-form{
        background-color: #ceb592;
        color: white;
        border: solid 1px #ceb592;
    }

    .btn-form:hover{
        background-color: #84cba4;
        color: white;
        border: solid 1px #84cba4;
    }
</style>
</body>
</html>